<div class="admin-container">
  
  <div class="dashboard-header">
    <h1 class="page-title">Управление на поръчки</h1>
    
    <div class="stats-row">
      <div class="stat-card">
        <span class="stat-label">Чакащи поръчки</span>
        <span class="stat-value">{{ getPendingOrdersCount() }}</span>
      </div>
      <div class="stat-card">
        <span class="stat-label">Предстоящи монтажи</span>
        <span class="stat-value">{{ getPendingAppointmentsCount() }}</span>
      </div>
      <div class="stat-card black">
        <span class="stat-label">Оборот (Месец)</span>
        <span class="stat-value">{{ calculateMonthlyRevenue() }} лв.</span>
      </div>
    </div>
  </div>

  <div class="controls-bar">
    
    <div class="tabs">
      <button 
        [class.active]="activeTab === 'orders'" 
        (click)="activeTab = 'orders'">
        Продукти
      </button>
      <button 
        [class.active]="activeTab === 'appointments'" 
        (click)="activeTab = 'appointments'">
        Запазени Часове
      </button>
    </div>

    <div class="actions">
      <div class="search-box">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" placeholder="Търсене по име/тел..." [(ngModel)]="searchTerm">
      </div>
      
      <button class="export-btn" (click)="exportToExcel()">
        <i class="fa-solid fa-file-excel"></i> ИЗТЕГЛИ СПРАВКА
      </button>
    </div>
  </div>

  @if (activeTab === 'orders') {
    <div class="table-container fade-in">
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Дата</th>
            <th>Клиент</th>
            <th>Продукти</th>
            <th>Сума</th>
            <th>Статус</th>
            <th>Действие</th>
          </tr>
        </thead>
        <tbody>
          @for (order of filteredOrders; track order.id) {
            <tr>
              <td>#{{ order.id }}</td>
              <td>{{ order.date }}</td>
              <td>
                <div class="client-info">
                  <strong>{{ order.customerName }}</strong>
                  <span>{{ order.phone }}</span>
                </div>
              </td>
              <td>
                <span class="product-summary" title="{{ order.items }}">{{ order.items }}</span>
              </td>
              <td class="price-cell">{{ order.total }} лв.</td>
              <td>
                <span class="status-badge" [ngClass]="order.status">
                  {{ getStatusLabel(order.status) }}
                </span>
              </td>
              <td>
                <select (change)="updateOrderStatus(order, $event)" [value]="order.status" class="status-select">
                  <option value="pending">Чакаща</option>
                  <option value="shipped">Изпратена</option>
                  <option value="completed">Завършена</option>
                  <option value="cancelled">Отказ</option>
                </select>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

  @if (activeTab === 'appointments') {
    <div class="table-container fade-in">
      <table>
        <thead>
          <tr>
            <th>Дата & Час</th>
            <th>Клиент</th>
            <th>Адрес</th>
            <th>Услуга</th>
            <th>Статус</th>
            <th>Действие</th>
          </tr>
        </thead>
        <tbody>
          @for (app of filteredAppointments; track app.id) {
            <tr>
              <td class="date-cell">
                <strong>{{ app.date }}</strong>
                <span>{{ app.time }}</span>
              </td>
              <td>
                <div class="client-info">
                  <strong>{{ app.customerName }}</strong>
                  <span>{{ app.phone }}</span>
                </div>
              </td>
              <td>{{ app.address }}</td>
              <td>{{ app.serviceType }}</td>
              <td>
                <span class="status-badge" [ngClass]="app.status">
                  {{ getStatusLabel(app.status) }}
                </span>
              </td>
              <td>
                <div class="action-buttons">
                    <button class="icon-btn check" (click)="completeAppointment(app)" title="Завърши">
                        <i class="fa-solid fa-check"></i>
                    </button>
                    <button class="icon-btn trash" (click)="cancelAppointment(app)" title="Откажи">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  }

</div>
